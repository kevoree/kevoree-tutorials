# Breakdown alone component
This step shows you how to write a component able to trigger an adaptation of the system by himself. For this purpose, the idea is to create a BreakdownAlone component that suppresses himself if no message is received within a give delay.    
In order to realize this step, setup your environment as in *Practice 1*: a runtime, an editor and you prefered IDE. In addition, you also need the code of the **Breakdown** that you can  find in the Kevoree-samples Github repository.

[Kevoree Samples](https://github.com/kevoree/kevoree-samples)

### Understanding the assembly

First of all open the Breakdown sample project in your IDE.   

To check everything is fine, we first compile the project, and lauch it using the Kevoree Runner embedded in the Kevoree Plugin. This runner reads the bootstrap configuration from a file that must be located at `src/main/kevs/main.kevs`. 

Open a terminal
***************
```
cd Breakdown
mvn clean install
mvn kev:run
```

If everything is working well, you should see :    
`00:01 INFO: A friend! delay my suppression`   
This message is displayed, because the Breakdown component has a Ticker friend component to keep it alive. Also, the squeletton of the project is initialized, but no action is taken in case the friend disapears.   

To check this configuration, we open the model of the current running system in an editor. 
See the configuration generated by the `main.kevs` bootstrap file.

> In a Kevoree Editor go to : *File > Load From Node*    
> And leave the prompt as is (default:`localhost:9000`).

Give a look at the `period` property of the *Ticker* component. The Ticker ticks every `1s` (1000 ms). This period has been set to this value in the `main.kevs` file.   
Also, you can see that the *Breakdown* component waits `2s` before feeling alone (i.e.: period in which no message is received).   
In the editor, set the `period` property of the *Ticker* component to 3s (3000ms) and push the model on the node to dynamically update the system manualy.

See the ticker ticks every 1 second    
See the Breakdown occurs after 2s of silence    
Set the `time` property to 3s and push to the runtime

Now you should observe :    
`Feeling alone, should suppress myself... I'm breakdown`   
That's great actually. Now, the Breakdown detects its lonelyness, but take no action.    
Let's add this action.

### Make the component reactive

*Open* the project in your IDE    
*Open* **BreakdownAlone** Java class    
*Put a code* in the action to self-uninstall the component, it should like the code on the right.     
You can use the *context* to get the instance name of the component and the name of the node on which the component is deployed.    
The *modelService* gives you access to the current model of the runing system.   
The *kevScriptService* engine helps to modify a model.    

<span class="warning-bloc"><span class="fa fa-exclamation-triangle fa-lg orange"></span> The models provided by the `getCurrentModel` method are always **ReadOnly**. To be able to cahneg these models, you hae to explicitly ask for a modifiable clone as shown on the right.</span>

```java
	@Override
    public void run() {
        try {
            Log.info("i'm alone... kill myself...");
            ModelCloner cloner = new DefaultModelCloner();
            ContainerRoot clonedModel = cloner.clone(modelService.getCurrentModel().getModel());
            kevScriptService.execute("remove " + context.getNodeName() + "." + context.getInstanceName(), clonedModel);
            modelService.update(clonedModel, null);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
```

To evaluate your code, we recomand you use the Kevoree Runner facility.   
Shutdown any running *Kevoree Runtime*, and launch another one.    
A new runtime will launch using the newly compiled sources.   

<span class="info-bloc"><span class="fa fa-lightbulb-o fa-lg blue"></span> **Remember** You have to manualy update the *period* property of the `ticker` to make the *breakdown* component feel alone.</span>    

At the end of this step, you should have a component, which uninstall himself after printing the message. Verify that everything has worked by refresh the model in the editor after the supression of the breakdown component.

> To test your code:
***************
```
mvn clean install
mvn kev:run
```
